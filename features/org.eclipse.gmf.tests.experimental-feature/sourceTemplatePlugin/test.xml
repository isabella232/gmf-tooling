<?xml version="1.0"?>
<project name="Automated Testing for GMF (Experimental)" default="all" basedir=".">
	<!-- Adjust these properties as appropriate before executing tests. During the automated build,
	     these are set based on the build configuration settings. -->
	<property name="baseLocation" value="${basedir}/../.."/>
	<!-- Load the pluginVersions.property file generated by the build -->
	<property file="${buildRoot}/tests-experimental/finalPluginsVersions.properties"/>

	<target name="cleanup.config">
		<echo message="Cleaning up eclipse config..."/>
		<delete includeemptydirs="true">
			<fileset dir="${baseLocation}/configuration">
				<include name="**/*"/>
				<exclude name="config.ini"/>
				<exclude name="*.log"/>
			</fileset>	
		</delete>
	</target>
		
	<target name="runtests" description="Executes the junit tests for a specified plug-in.">
		<echo message="Running tests for ${testPlugin}..."/>
		<ant antfile="${basedir}/src/${testPlugin}_${version}/test.xml" dir="${baseLocation}" />
		<move file="${baseLocation}/${testPlugin}.xml" tofile="${basedir}/testresults/xml/${testPlugin}.xml" />
	</target>

	<!-- For each, the qualifier value is what's found in generated pluginVersions.properties file. Typically, 
	     it is the build id (e.g. I20060131-0200) -->
	<target name="all" depends="cleanup.config" description="Runs the test.xml of the test plugins">
		<antcall target="runtests">
			<param name="testPlugin" value="org.eclipse.gmf.tests.lite" />
			<param name="version" value="${org.eclipse.gmf.tests.lite}" />
		</antcall>
		<antcall target="genHtml"/>
	</target>

	<target name="genHtml" description="Generates HTML results with provided JUNIT.XSL provided">
		<style style="${basedir}/JUNIT.XSL" basedir="${basedir}/testresults/xml" destdir="${basedir}/testresults/html/" />
	</target>
</project>
