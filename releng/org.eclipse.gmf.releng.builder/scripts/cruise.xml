<?xml version="1.0"?>
<project default="cruise">
	<property file="build.properties" />
	
	<!-- Commonly used directories -->
	<property name="reportdir" value="${cc.home}/reporting" />
	<property name="checkout" value="${buildRoot}/checkout" />
	<property name="logs" value="${buildRoot}/logs" />
	<property name="remotelogs" value="logs" />
	<property name="artifacts" value="${buildRoot}/artifacts" />
	<property name="cc.publish" value="${buildRoot}/ccpublish" />

	<target name="init">	
		<delete file="${basedir}/cc.properties" failonerror="false"/>
		<!-- Store the build properties in a file for CruiseControl to pick up. -->
		<echo file="${basedir}/cc.properties" append="true">
buildRoot=${buildRoot}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
cc.home=${cc.home}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
buildmaster.email=${buildmaster.email}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
always.email=${always.email}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
mailhost=${mailhost}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
reporting.url=${reporting.url}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
reportdir=${reportdir}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
checkout=${checkout}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
remotelogs=${remotelogs}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
logs=${logs}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
artifacts=${artifacts}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
ext=${ext}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
cc.publish=${cc.publish}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
scripts=${scripts}
		</echo>

		<echo file="${basedir}/cc.properties" append="true">
ccweb.ftp.host=${ccweb.ftp.host}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
ccweb.ftp.user=${ccweb.ftp.user}
		</echo>
		<echo file="${basedir}/cc.properties" append="true">
ccweb.ftp.passwd=${ccweb.ftp.passwd}
		</echo>


		<mkdir dir="${logs}/continuous"/>
		<mkdir dir="${logs}/integration"/>
		<mkdir dir="${logs}/nightly"/>
		<mkdir dir="${logs}/checkout"/>
		<mkdir dir="${cc.publish}/gmf"/>
		<mkdir dir="${artifacts}/cc"/>
		<available file="${buildRoot}/checkout/org.eclipse.gmf/features/org.eclipse.gmf.sdk-feature/build.properties" property="skipCheckout" />
		<antcall target="checkout"/>
	</target>
	
	<target name="cruise" depends="init">
		<java classname="CruiseControl" maxmemory="1024m" fork="true" failonerror="true">
			<jvmarg value="-Djavax.management.builder.initial=mx4j.server.MX4JMBeanServerBuilder" />
			<arg line="-jmxport 8000"/>
			<classpath>
			    <fileset dir="${cc.home}/lib">
				<include name="**/*.jar"/>
			    </fileset>
			    <!--
			    <fileset dir="${cc.home}/main/lib">
		        	<include name="**/*.jar"/>
		      	    </fileset>
			    <fileset dir="${cc.home}/main/dist">
		        	<include name="**/*.jar"/>
		      	    </fileset>
			    -->
			    <fileset dir="${java.home}/lib">
				<include name="tools.jar"/>
			    </fileset>
			</classpath>
		</java>
	</target>
	
	<target name="checkout" unless="skipCheckout">
		<ant antfile="${basedir}/checkout.xml" target="all"/>
	</target>

</project>
